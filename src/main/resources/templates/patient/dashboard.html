<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:if="${patientData != null}" th:text="|${patientData.fhirId} - ': Patient dashboard'|">Dashboard</title>
    <title th:if="${patientData == null}">Dashboard</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<body>

<div class="container-fluid">

    <div th:if="${feedbackIsNeededMessage == null}" class="alert alert-warning alert-dismissible show" role="alert">
        <strong>Feedback needed!</strong> Your time for feedback is over, please leave feedback anyway!
    </div>

    <div th:fragment="show-patient" id="patient-data" data-draggable="true" tabindex="-1" role="dialog">

            <div th:if="${fhirPatient == null}" >
                <h1>Patient Name</h1>
                <div>Patient Birthdate</div>
                <div>Patient address</div>
            </div>


            <div th:if="${fhirPatient != null}" >
                <h1 th:text="${fhirPatient.getName().get(0).given + ' ' + fhirPatient.getName().get(0).family}">Patient Name</h1>
                <div th:text="${#dates.format(fhirPatient.birthDate, 'dd-MM-yyyy HH:mm')}">Patient Birthdate</div>
                <div th:text="${fhirPatient.address.get(0).city + ' ' + fhirPatient.address.get(0).postalCode}">Patient address</div>
            </div>

            <table class="table table-striped table-responsive-md">
                <thead>
                    <tr>
                        <th>Practitioner</th>
                        <th>Instruction content</th>
                        <th>Given at</th>
                        <th>Your Comment</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>practitioner-example</td>
                        <td>Example content</td>
                        <td th:text="${#dates.format(#dates.createNow(), 'dd MMM yyyy HH:mm')}"></td>
                        <td><span class="badge bg-warning text-dark">feedback!</span> Need to be done within 3 days!</td>
                    </tr>
                    <tr th:each="instr : ${patientData?.instructions}">
                        <td th:text="${instr.practitioner.id}"></td>
                        <td th:text="${instr.instruction?.content}"></td>
                        <td th:text="${instr.givenAt.toString()}"></td>
                        <td th:text="${instr.comment}">
                            <span th:if="${instructionIDforFeedback != null && instr.id == instructionIDforFeedback}"
                          class="badge bg-warning text-dark">feedback!</span></td>
                    </tr>
                </tbody>
            </table>

    </div>
</div>

</body>
</html>